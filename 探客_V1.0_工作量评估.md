```
触发条件 -> {
	执行操作
    	- 成功，执行下一步
    	- 失败，反馈错误
}
```

主任务下面的附加任务流程
其他用户信息界面
修改用户信息界面
我正在玩的界面
我已完成的界面
我的奖励界面
我的裁判任务界面
设置界面
关于界面
反馈意见界面

#### 系统消息
1. 系统消息界面

## 用户

#### 登录注册
1. 登录界面
	1. 显示
	输入框、登录按钮、注册按钮、第三方登录按钮、用户协议、忘记密码按钮

    2. 操作
    ```
	点击忘记密码按钮 -> {
    	跳转重设密码界面
    }

	点击登录按钮 -> {
    if 手机号不为空且有效且密码不为空:
    	调用登录接口
    	- 成功：存储用户信息到SharePreference，并跳转主界面
    	- 失败：提示用户手机号或密码不正确
    else :
    提示手机号输入有误或密码为空
    }

	点击用户协议 -> {
    	跳转用户协议展示界面
    }

	点击注册按钮 -> {
    	跳转用户协议界面
        在这里决定用户协议界面的下一步跳转的界面，以及其携带的信息
    }

	点击第三方登录按钮 -> {
    	跳转第三方登录界面，授权登录之后获取一个OAuthId,上传OAuthId，获得用户信息
    	if 第一次三方登录:
        	跳转用户协议界面
            Intent intent = new Intent(context, UserContractActivity.class);
            Intent intentToNext = new Intent(context, PrefectUserInfoActivity.class);
            intentToNext.put("data",userJsonString);
            intent.putExtra("next", intentToNext);
            else :
            跳转主界面
    }
	```

2. 用户协议界面（显示用户协议相关内容
	1. 显示
	用户协议相关信息、同意按钮、下一步按钮
    2. 操作
   	```
    init -> {
    	disable 下一步按钮
    }
    点击同意按钮 -> {
    	clickable 下一步按钮
    }
    点击下一步按钮 -> {
    	根据intent直接跳转界面
    }
	```

3. 注册界面
	1. 显示
	手机号输入框、验证码输入框、发送验证码按钮、密码输入框、下一步按钮
	2. 操作
	```
	init -> {
    	disable 下一步按钮
    }

	点击发送验证码按钮 -> {
    	if (手机号不为空 && 手机号有效) ：
    		调用验证码接口，改变发送验证码按钮状态为倒计时60s，调用成功更改下一步按钮状态为clickable,调用失败则提示用户并更改发送验证码按钮状态为可点击
    	else :
        	提示用户手机号输入有误

	点击下一步按钮 -> {
    	if (手机号不为空 && 手机号有效 && 验证码不为空 && 验证码有效 && password != null && password is valid) :
    	将表单发送到服务器验证
        - 注册成功，返回userId
        	跳转到完善用户信息界面
        - 注册失败
        	提示用户失败原因，例：“该用户已注册”
    else :
    	反馈错误信息
    }
    ```
	3. 数据
	4. 注意
	手机号13位
    验证码6位
    登录密码6位以上


4. 重设密码界面
	1. 显示
	帐号输入框、新密码输入框、验证码输入框、获取验证码按钮、确定按钮、back按钮
    2. 操作
    ```
    init -> {
    	设置确认按钮为不可点击
    }

    点击获取验证码按钮 -> {
    	if (手机号不为空 && 手机号有效) ：
    		调用验证码接口，改变发送验证码按钮状态为倒计时60s，调用成功更改确认按钮状态为clickable,调用失败则提示用户并更改发送验证码按钮状态为可点击
    	else :
        	提示用户手机号输入有误
    }

	点击确定按钮 -> {
    	if (手机号不为空 && 手机号有效 && 验证码不为空 && 验证码有效 && password != null && password is valid) :
    	发送表单至服务器，进行更改密码
        - 成功
        	提示用户修改成功，关闭当前页面
        - 失败
        	提示用户失败原因，例：“该用户还未注册”
    else :
    	反馈错误信息
    }
    ```

#### 基本信息
1. 用户信息完善界面

	1. 显示
	ImageView一个、TextView若干

    2. 操作

    ```
    init -> {
        - 如果是第三方登录
            - 头像：
            - 昵称：
            - 其他信息：
        - 如果是手机号登录
            - 昵称：为唯一标识符（例：探客108088
            - 手机号：获取从注册界面传入的手机号
        - 所在地：定位获取所在地，成功则更新
    }

    点击各项修改 -> {
        传入当前值，跳转到修改信息界面
    }

	点击下一步按钮 -> {
        各项判空以及是否有效
        - 有效：上传服务器
        - 成功：跳转主界面
        - 失败：反馈失败信息
        - 无效：提醒用户哪项有误
	}
	```

    3. 数据
    默认用户数据
    头像：默认url
    昵称：未知
    手机号：未绑定
    生日：1990-01-01
    性别：男
    身高：175
    体重：65
    所在地：未知

2. 用户中心界面
	1. 显示
		用户头像、性别、所在地、ID、等级以及经验值、进入修改界面按钮
        我正在玩的
        我已完成的
        我的奖励
        我的裁判任务
        设置
	2. 操作
	```
    init -> {
    	通过当前用户id,
    }
    ```

3. 其他用户信息界面

4. 修改用户信息界面

5. 我正在玩的界面

6. 我已完成的界面

7. 我的奖励界面

8. 我的裁判任务界面

## 游戏

#### 游戏浏览
1. 首页界面

	1. 显示
	游戏列表、定位按钮、扫一扫按钮、首页title、底部菜单
	游戏列表item内容:
    	- 圆角图片
    	- 游戏title
    	- 地点
    	- 时间
    	- tag
	2. 操作
	```
    init -> {
    	1.读取SharePreference里的首页Location字段（默认为武汉），请求该地区的活动并更新列表
        2.定位用户所在城市，与首页Location字段比较
        	- 相同
        		不做操作
            - 不同
            	访问已开通城市列表，城市是否开通
        			- 已开通
        				提示用户是否需要切换至当前城市
                        	- 确认
                        		更新SharePreference里的首页Location字段，请求该地区的活动并更新列表
                        	- 取消
                        		不做任何操作
        			- 未开通
        				提示用户所在城市未开通，不做操作
    }

    点击定位城市按钮 -> {
    	用startActivityForResult()启动定位城市界面
    }
        城市定位界面回传城市信息 -> {
            判断resultCode以及requestCode
                 - 为0
                    不进行任何操作
                - 不为0
                    获取传回的用户选中的城市信息，并向服务器请求该城市的游戏信息，更新列表
        }

	点击扫一扫按钮 -> {
    	启动扫码界面
    }
        扫码界面返回团队唯一id -> {
            判断resultCode以及requestCode
                - 为0
                    不进行任何操
                - 不为0
                    根据返回的团队id、当前用户id加入该团队
                    	- 成功
                    		需要得到团队信息以及团队所在游戏的信息，保存上述信息至全局变量中，提示用户加入成功,传入团队信息，跳转团队成员管理界面
                    	- 失败
                    		提示用户失败原因，例如：“该团队人数已满”或“该团队不存在”
        }

    点击游戏列表item -> {
    	从服务器查询当前用户是否用已经参加过该活动
        - 参加过，返回所在团队id
        	从服务器查询该团队是否已经完成比赛
            	- 未完成
            		跳转玩游戏的界面
            	- 已完成
            		传入团队id,游戏id,跳转入分享界面
        - 未参加
        	传入游戏id,跳转游戏详情界面
    }

	点击底部菜单 -> {
    	跳转对应界面
    }
    ```




2. 定位城市界面
	1. 显示
	back按钮、定位城市按钮、已开通城市按钮
    2. 操作
    ```
    init -> {
    	1.开始请求定位城市
    	2.定位城市按钮设置成disable，并显示“定位中...”或Progress.dialog
    	3.获取服务器已开通城市并刷新列表
    }

	点击已开通城市或定位城市 -> {
    	更新SharePreference里的首页Location字段，设置返回城市信息，结束当前界面
    }

    点击back按钮 -> {
    	中止一切进行的活动，结束当前界面
    }

    ```

#### 游戏详情
1. 游戏详情界面
	1. 显示
	back按钮、分享按钮、游戏title、
    大图cover展示、tag
    游戏地点（clickable）
    游戏时间
    游戏人气
    webview展示游戏简介以及游戏规则等等
    底部多功能按钮

    2. 操作
    ```
    init -> {
    	1. 获得传入的游戏id,显示"信息加载中...."
        2. 根据id从服务器获取游戏相关信息
        	- 成功
        		绑定数据，webview默认加载主题简介内容,取消"信息加载中...."
        	- 失败
        		取消"信息加载中...."，网络异常或其他错误
        3. 上传用户id,获取用户是否组队，根据用户当前组队状态、游戏状态，更新底部多功能按钮显示情况
        	- 维护中
        						显示“维护中”，disable
            - 非维护中
            	- 已组队
            					显示“组队中”,点击进入成员管理界面
            		- 游戏开始
            					显示“队长已开始游戏”，点击进入成员管理界面
                    - 游戏结束
                    			显示“游戏已结束”，disable
            	- 未组队
            					显示“开始组队”,点击弹出对话框，创建队伍或者加入队伍
            		- 游戏开始
            					显示“游戏已开始，您未组队参与”，disable
                    - 游戏结束
                    			显示“游戏已结束”，disable
    }

    点击back按钮 -> {
    	终止一切行为，退出界面
    }

    点击分享按钮 -> {
    	分享通过游戏id构造的网页url
    }

	点击游戏地点 -> {
    	传入游戏数据结构中的latlng,跳转进入游戏地点地图界面
    }

    点击游戏简介或游戏规则 -> {
    	切换到各自的界面，设置对应html代码给webview
    }

	点击底部多功能按钮 -> {
    	根据init的状态，点击之后进行不同的跳转
        - 维护中
        						disable
            - 非维护中
            	- 已组队
            					点击进入成员管理界面
            		- 游戏开始
            					点击进入成员管理界面
                    - 游戏结束
                    			disable
            	- 未组队
            					点击弹出对话框，创建队伍或者加入队伍
            		- 游戏开始
            					disable
                    - 游戏结束
                    			disable
    }

    点击对话框中的创建队伍按钮 -> {
    	对话框消失，跳转进入创建队伍界面
    }
	点击对话框中的扫码组队按钮 -> {
    	对话框消失，进入扫描二维码界面，等待回调
    }
    扫描二维码界面回调返回团队id -> {
    	根据返回的团队id，调用服务器的加入队伍接口
        - 成功
        	提示用户加入团队成功，跳转进入团队成员管理界面
        - 失败
        	提示用户失败的原因，例：“团队不存在，请重试”
    }

    ```

2. 游戏地点地图界面


#### 玩游戏
1. 玩游戏界面
	1. 显示
	基础地图、地图上下一个攻击点的标记、目标攻击点周围的光环、用户当前所在位置、跑过的运动轨迹、已经到达过的攻击点标记、相关数据按钮
	2. 操作
	```
    init -> {
    	1.初始化地图操作，初始化并启动定位、日志记录等组件
        2.地图初始化完成之后，自动跳转第一个攻击点位置
        3.启动定位服务，显示用户当前位置
        4.提示用户当前为实验点，到达实验点并完成任务之后，正式开始比赛并计时
    }

	用户移动 -> {
    	1.日志记录组件记录用户运动日志轨迹
        2.在地图上显示移动的轨迹
        3.结合百度鹰眼轨迹服务，上传轨迹至百度
        4.检测是否靠近当前攻击点
        	- 是
        		触发主动事件
            - 否
            	不进行操作
    }

	靠近下一个目标点 -> {
    	提示用户点击即可揭晓该点的任务
        用户点击之后，跳转对应的任务界面
    }

	点击下一个目标点 -> {
    	检测该目标点是否被触发(也就是是否在目标点附近)
        - 是
        	获取该点的任务，跳转对应的任务界面
        - 否
        	提示用户需要到达攻击点之后，才能揭晓任务
    }
    任务界面回调 -> {
   		任务是否完成
        - 是
        	1.当前攻击点通过，点标改变状态
        	2.运动日志记录特殊事件
        	3.向服务器传达特殊事件
        - 否
        	提示用户任务没有完成，点击地图上的攻击点标再次进入任务界面
    }

	点击相关按钮 -> {
    	跳转到玩游戏相关信息界面
    }

	网络断开、gps断开时候 -> {
    	停止一切组件的运转，提示用户恢复网络再继续
    }
    ```

2. 玩游戏相关信息界面
	1. 显示
	back按钮、页面title、分享界面
    游戏数据item
    	- 开始游戏item
    		- 开始游戏的时间
    	- 结束游戏item
    		- 结束游戏时间
    	- 完成任务item
    		- 完成任务耗费时间，获得经验值
	2. 操作
	```
    init -> {
    	从网络或者本地日志中获取团队在游戏中的相关信息，绑定数据
    }

	点击back按钮 -> {
    	关闭当前页面
    }

	点击分享按钮 -> {
    	分享当前成绩截图
    }
    ```

#### 游戏任务
1. 扫码游戏任务界面

	1. 显示
	back按钮、任务类型title
    任务描述textview
    扫描GM二维码按钮

    2. 操作
    ```
    init -> {
    	获取当前任务的信息，绑定数据
    }

	点击back按钮 -> {
    	关闭当前页面
    }

	点击扫描二维码按钮 -> {
    	跳转进入扫描界面，识别二维码
    }
	扫描界面回调返回密钥 -> {
     	判断密钥是否匹配
        - 是
        	检查是否附带着附加任务
            - 是
            	使用附加任务的信息，更新界面，继续进行任务
            - 否
            	提示用户任务已完成，确认后关闭界面
        - 否
        	提示用户扫码有误，请重试
    }
    ```
2. 定位游戏任务界面
	1. 显示
	back按钮、webview显示任务内容、textview（确保gps开启...）
	2. 操作
	```
    init -> {
    	1.获取传入的任务信息，绑定数据
        2.启动定位服务
    }

	用户移动 -> {
    	判断用户是否到达指定范围内
        - 是
        	弹出对话框，成功找到地点，确认返回
        - 否
        	不进行操作
    }
    ```
3. 谜底游戏任务界面
	1. 显示
	back按钮、任务类型title
    任务描述textview
    输入谜底文本框
    确认谜底按钮
	2. 操作
	```
    init -> {
    	获取当前任务的信息，绑定数据
    }

	点击back按钮 -> {
    	关闭当前页面
    }

	点击确认谜底按钮 -> {
    	谜底不为空 && 与正确答案相同
        - 是
        	提示用户任务已完成，确认后关闭界面
        - 否
        	提示用户答案错误
    }

    ```
4. 扫描游戏任务界面
	1. 显示
	back按钮、任务类型title
    任务描述textview
    启动扫描界面按钮
	2. 操作
	```
    init -> {
    	获取当前任务的信息，绑定数据
    }

    点击back按钮 -> {
    	关闭当前页面
    }

    点击启动扫描界面按钮 -> {
    	启动扫描界面
    }
	扫描界面回调返回照片uri -> {
    	通过静态函数来判断场景与图片是否匹配
        - 是
        	提示用户任务已完成，确认后关闭界面
        - 否
        	提示匹配失败
    }
    ```

#### 日志功能
1. 无界面
	1. 显示
	无
    2. 操作
    ```
    init -> {
    	扫描目录下的所有日志文件等
    }

    start -> {
    	开始根据返回的位置信息记录用户轨迹
        根据玩游戏界面发送的信号，记录特殊事件（例如：完成攻击点任务，开始游戏，结束游戏等等）
    }

	pause -> {
    	暂停日志记录
    }

	resume -> {
    	恢复日志记录
    }

	stop -> {
    	停止日志记录
    }
    ```


## 团队

#### 创建队伍
1. 创建队伍界面
	1. 显示
	back按钮、创建队伍title
    队伍名称输入框
    下一步按钮
	2. 操作
	```
    init -> {
    	将下一步按钮设置为不可点击
    }

	点击back按钮 -> {
    	关闭当前页面
    }

	用户输入团队名称时 -> {
    	检测团队名称是否为空
        - 是
        	将下一步按钮设置为不可点击
        - 否
        	将下一步按钮设置为可点击
    }

	点击下一步按钮 -> {
    	上传用户id,游戏id,团队名称，调用服务器接口创建团队
        - 成功
        	提示用户创建团队成功，开始招募小伙伴吧，跳转进入团队成员管理界面
		- 失败
			提示用户创建失败，例：“团队名称已经被人抢先一步了”
    }
	```

#### 成员管理
1. 团队成员管理界面
	1. 显示
	back按键、团队title、出示团队二维码按钮、团队管理菜单（包含队伍信息按钮、解散队伍按钮（队长）或者退出团队按钮（队员））
    队员详情item
    	- 圆角图片
    	- 游戏title
    	- 地点
    	- 时间
    	- tag

   	底部多功能按钮

	2. 操作
	```
    init -> {
    	获取其他界面传入的团队id
        1.从服务器获取团队信息，绑定数据，判断当前用户是否是队长，依此来改变界面
    }

	点击back按钮 -> {
    	结束当前页面
    }

	点击团队二维码按钮 -> {
    	生成并弹出团队二维码
    }

	*队员点击团队管理菜单 -> {
    	弹出菜单弹窗，再次点击关闭
    }
    *队员点击退出团队按钮 -> {
    	调用服务器退出团队接口
        - 成功
        	调用IM通知队长，团队有成员离开
        - 失败
        	提示用户，退出团队失败
    }

    *队员点击底部多功能按钮 -> {
    	查询本地文件，用户是否下载游戏
        - 已下载
        	调用服务器查询队伍是否开始游戏接口
            - 已开始
            	跳转进入玩游戏界面
            - 未开始
            	提示用户，队长还未开始游戏，请在队长开始之后重试
        - 没下载
        	提示用户下载
    }

	**队长点击团队管理菜单 -> {
    	弹出菜单弹窗，再次点击关闭弹窗
    }
    **队长点击队伍信息按钮 -> {
    	生成并弹出团队二维码
    }
    **队长点击解散队伍按钮 -> {
    	询问用户是否真的解散队伍？
        - 是
        	调用服务器解散队伍接口，dismiss对话框
            - 成功
            	用IM通知团队队员，队伍已经被解散了
            - 失败
            	提示用户，解散队伍失败
        - 否
        	dismiss对话框
    }

	**队长向左滑动团队成员列表（除了自己的item） -> {
    	展示出“移除”按钮，类似于qq的侧滑删除
    }
    	**队长点击“移除”按钮，提示用户是否真的要移除该队员
        - 是
        	调用服务器剔除团队成员接口
        	- 成功
        		删除列表item，用IM通知被移除的用户
        	- 失败
        		提示用户，移除用户失败
       	- 否
       		不进行任何操作

	**队长点击底部多功能按钮 -> {
    	查询本地文件，用户是否下载游戏
        - 已下载
        	提示用户寻找GM扫码开始比赛
        - 没下载
        	提示用户先下载游戏包
    }
    ```

## 功能

#### 初始化页面
1. 显示
	显示logo

2. 操作
	```
    init -> {
    	if not SharePreference里面存在版本号 :
        	启动新版本引导页
    	else if 版本号小于当前版本号:
        	启动新版本引导页
    	else if UserManager.noAvaliableUser():
    		启动登录页面
    	else :
    		启动主界面
    }
	```

#### 新版本引导页
1. 显示
	显示三张gif的ViewPager

2. 操作

```
	点击进入按钮后 -> {
    	if UserManager.noAvaliableUser():
    		启动登录页面
    	else :
    		启动主界面
    }
```

#### 升级模块

在开始时，访问接口

@(Server) checkAppVersion

失败：
return

成功：
返回

```
{
    versionName
    versionCode
}
```

```
if (versionCode > 当前的版本号) {
    showDialog("是否下载")
    确定 -> {
        启动下载流程，下载，下载好后，提示是否安装。
    }

    取消 -> {
        return
    }
}
```

#### 二维码模块

扫一扫功能

1. 显示
定位框、导入图片按钮，返回按钮。
2. 操作

```

点击返回功能 -> {
    返回Cancel信号，并结束该界面
}

点击图片按钮 -> {
    启动相册界面，并等待其返回。
}

相册界面返回Uri -> {
    将Uri所带表的图片进行扫描。
}

扫描结束(可能是摄像头扫描到二维码，或扫描图片上的二维码结束) -> {
    如果成功
    返回扫描到的信息，结束该界面

    如果失败
    返回『什么都没有发现』
}


```

#### 数据上报
数据上报

#### 系统设置
1. 系统设置界面

2. 设置界面

3. 关于界面

4. 反馈意见界面

#### 系统消息
1. 系统消息界面



#### 城市定位
